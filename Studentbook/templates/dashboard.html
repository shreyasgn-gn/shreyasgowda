<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Student Book Market</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        // Enable Tailwind dark mode
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition">

<!-- ================= HEADER ================= -->
<header class="bg-white dark:bg-gray-800 shadow px-6 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
            {{ session.name[0]|upper }}
        </div>
        <span class="font-semibold">{{ session.name }}</span>
    </div>

    <div class="flex items-center gap-3">
        <!-- DARK/LIGHT TOGGLE -->
        <button onclick="toggleTheme()"
                class="bg-gray-200 dark:bg-gray-700 px-3 py-2 rounded text-xl">
            <span id="themeIcon">üåô</span>
        </button>

        <a href="/logout"
           class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
            Logout
        </a>
    </div>
</header>

<!-- ================= SEARCH & ADD ================= -->
<div class="flex flex-col md:flex-row justify-center items-center gap-4 mt-6 mb-8">
    <form method="get" class="flex gap-2">
        <input type="text" name="search"
               value="{{ request.args.get('search','') }}"
               placeholder="Search books..."
               class="border p-3 rounded-xl w-64 bg-white dark:bg-gray-800
                      dark:border-gray-600 focus:ring-2 focus:ring-blue-400">
        <button class="bg-blue-600 text-white px-4 py-3 rounded-xl hover:bg-blue-700 transition">
            Search
        </button>
    </form>

    <a href="/add"
       class="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition">
        + Add Book
    </a>
</div>

<!-- ================= BOOK GRID ================= -->
<div class="max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 px-4">

{% for b in books %}
<div class="bg-white dark:bg-gray-800 rounded-3xl shadow-lg hover:shadow-2xl transition overflow-hidden">

    <!-- Book Image -->
    {% if b.image %}
    <img src="{{ url_for('static', filename='uploads/' ~ b.image) }}"
         class="w-full h-48 object-cover">
    {% else %}
    <div class="w-full h-48 bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-500">
        No Image
    </div>
    {% endif %}

    <!-- Book Info -->
    <div class="p-4 space-y-1">
        <h3 class="font-bold text-lg">{{ b.title }}</h3>
        <p class="text-gray-400">Author: {{ b.author }}</p>
        <p>Price: ‚Çπ{{ b.price }}</p>
        <p>Condition: {{ b.condition_book }}</p>
        <p class="text-sm text-gray-500">Seller: {{ b.seller_name }}</p>

        <!-- CONTACT FOR BUYER -->
        {% if session.user_id != b.seller_id %}
        <div class="mt-3 flex gap-2">
            <a href="tel:{{ b.contact_number }}"
               class="flex-1 bg-blue-600 text-white py-2 rounded-xl text-center hover:bg-blue-700">
                üìû Call
            </a>
            <a href="https://wa.me/91{{ b.contact_number }}"
               target="_blank"
               class="flex-1 bg-green-600 text-white py-2 rounded-xl text-center hover:bg-green-700">
                üí¨ WhatsApp
            </a>
        </div>
        {% endif %}

        <!-- EDIT/DELETE FOR SELLER -->
        {% if session.user_id == b.seller_id %}
        <div class="flex gap-2 mt-3">
            <a href="/edit/{{ b.id }}"
               class="flex-1 bg-yellow-400 text-white py-2 rounded-xl text-center hover:bg-yellow-500">
                Edit
            </a>
            <a href="/delete/{{ b.id }}"
               onclick="return confirm('Delete this book?')"
               class="flex-1 bg-red-500 text-white py-2 rounded-xl text-center hover:bg-red-600">
                Delete
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% else %}
<p class="text-gray-400 text-center col-span-full">No books found.</p>
{% endfor %}

</div>

<!-- ================= THEME SCRIPT ================= -->
<script>
    const html = document.documentElement;
    const icon = document.getElementById("themeIcon");

    // Load saved theme
    if (localStorage.getItem("theme") === "dark") {
        html.classList.add("dark");
        icon.textContent = "‚òÄÔ∏è";
    }

    function toggleTheme() {
        html.classList.toggle("dark");
        if (html.classList.contains("dark")) {
            localStorage.setItem("theme", "dark");
            icon.textContent = "‚òÄÔ∏è";
        } else {
            localStorage.setItem("theme", "light");
            icon.textContent = "üåô";
        }
    }
</script>

</body>
</html>
